---
title: "Headless API"
description: "CLI and MCP server for automation, CI/CD, and AI integration"
order: 16
---

vcad provides headless interfaces for programmatic access without the UI. Use these for automation, CI/CD pipelines, batch processing, and AI agent integration.

## Rust CLI

Native command-line tool for file operations. Install with `cargo install vcad-cli` or build from source.

### Export

Convert `.vcad` files to mesh or CAD formats.

```bash
vcad export <input.vcad> <output>
```

Supported output formats (determined by extension):

| Extension | Format | Use case |
|-----------|--------|----------|
| `.stl` | Binary STL | 3D printing, CNC |
| `.glb` | glTF Binary | Visualization |
| `.step`, `.stp` | STEP AP214 | CAD interchange |
| `.urdf` | URDF | Robot simulation |

```bash
# Export to STL for 3D printing
vcad export bracket.vcad bracket.stl

# Export to STEP for CAD software
vcad export bracket.vcad bracket.step

# Export assembly to URDF for simulation
vcad export robot.vcad robot.urdf
```

<Callout type="info">
STEP export only supports primitive shapes and previously imported STEP files. Boolean operations convert geometry to mesh which cannot be exported to STEP.
</Callout>

### Import

Import external formats into vcad.

```bash
vcad import <input.step> <output.vcad> [--name <part-name>]
```

```bash
# Import a STEP file
vcad import part.step output.vcad

# Import with custom part name
vcad import part.step output.vcad --name "Imported Bracket"
```

### Import URDF

Import robot description files.

```bash
vcad import-urdf <input.urdf> <output.vcad>
```

```bash
vcad import-urdf robot.urdf robot.vcad
```

### Info

Display document information and mesh statistics.

```bash
vcad info <file.vcad>
```

Example output:

```
vcad document: bracket.vcad
  Version: 1.0.0
  Nodes: 5
  Materials: 2
  Scene entries: 1

Scene:
  1: Bracket (material: aluminum)

Mesh stats:
  Total triangles: 1284
  Total vertices: 642
```

### Interactive TUI

Launch the terminal-based 3D editor.

```bash
vcad tui [file.vcad]
```

The TUI provides:
- ASCII wireframe 3D viewport
- Feature tree navigation (j/k to move, Enter to edit)
- Keyboard shortcuts for primitives (1: box, 2: cylinder, 3: sphere)
- Real-time mesh evaluation via WASM

## MCP Server

Model Context Protocol server enabling AI agents to create CAD directly. Compatible with Claude Desktop, Cursor, and other MCP clients.

### Setup

Add to your MCP client configuration:

```json
{
  "mcpServers": {
    "vcad": {
      "command": "npx",
      "args": ["@vcad/mcp"]
    }
  }
}
```

For Claude Desktop, edit `~/Library/Application Support/Claude/claude_desktop_config.json` (macOS) or `%APPDATA%\Claude\claude_desktop_config.json` (Windows).

### Tools

The MCP server exposes three tools for CAD operations:

| Tool | Description |
|------|-------------|
| `create_cad_document` | Build geometry from primitives and operations |
| `export_cad` | Export to STL or GLB file |
| `inspect_cad` | Get volume, area, bbox, center of mass |

### create_cad_document

Creates a CAD document from structured geometry input. Returns an IR document that can be exported or inspected.

**Primitives**

| Type | Origin | Parameters |
|------|--------|------------|
| `cube` | Corner at (0,0,0) | `size: {x, y, z}` |
| `cylinder` | Base center at (0,0,0), +Z up | `radius`, `height`, `segments` |
| `sphere` | Center at (0,0,0) | `radius`, `segments` |
| `cone` | Base center at (0,0,0), +Z up | `radius_bottom`, `radius_top`, `height`, `segments` |

**Operations**

| Type | Description |
|------|-------------|
| `translate` | Move part by offset `{x, y, z}` |
| `rotate` | Rotate by angles `{x, y, z}` in degrees |
| `scale` | Scale by factor `{x, y, z}` |
| `hole` | Create vertical through-hole at position |
| `union` | Combine with another primitive |
| `difference` | Subtract another primitive |
| `intersection` | Keep only overlapping volume |
| `linear_pattern` | Repeat along direction |
| `circular_pattern` | Repeat around axis |

**Position specifications**

Operations that take a position (like `hole`) accept:

- **Absolute:** `{x: 25, y: 15, z: 0}` - exact coordinates in mm
- **Named:** `"center"`, `"top-center"`, `"bottom-center"` - relative to primitive bounds
- **Percentage:** `{x: "50%", y: "50%"}` - percentage of primitive dimensions

**Example: Bracket with holes**

```json
{
  "parts": [{
    "name": "Bracket",
    "primitive": {
      "type": "cube",
      "size": {"x": 50, "y": 30, "z": 5}
    },
    "operations": [
      {
        "type": "hole",
        "diameter": 5,
        "at": {"x": 10, "y": 15}
      },
      {
        "type": "hole",
        "diameter": 5,
        "at": {"x": 40, "y": 15}
      }
    ],
    "material": "aluminum"
  }]
}
```

### export_cad

Exports a CAD document to a file. Format is determined by file extension.

<Param name="ir" type="object">
IR document returned from `create_cad_document`.
</Param>
<Param name="filename" type="string">
Output filename with extension (`.stl` or `.glb`).
</Param>

```json
{
  "ir": { /* ... from create_cad_document */ },
  "filename": "bracket.stl"
}
```

### inspect_cad

Returns geometry properties for analysis and validation.

<Param name="ir" type="object">
IR document returned from `create_cad_document`.
</Param>

Returns:

| Property | Type | Description |
|----------|------|-------------|
| `volume` | `number` | Volume in mm³ |
| `surfaceArea` | `number` | Surface area in mm² |
| `boundingBox` | `{min, max}` | AABB corners |
| `centerOfMass` | `{x, y, z}` | Volume centroid |
| `triangleCount` | `number` | Mesh triangle count |

## Workflows

### CI/CD Export

Export models on every commit:

```yaml
# .github/workflows/export.yml
name: Export CAD
on: push
jobs:
  export:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install vcad
        run: cargo install vcad-cli
      - name: Export STL
        run: vcad export models/bracket.vcad dist/bracket.stl
      - uses: actions/upload-artifact@v4
        with:
          name: stl-files
          path: dist/*.stl
```

### Batch Processing

Convert multiple files with a shell loop:

```bash
for f in models/*.step; do
  vcad import "$f" "converted/$(basename "$f" .step).vcad"
done

for f in converted/*.vcad; do
  vcad export "$f" "stl/$(basename "$f" .vcad).stl"
done
```

### AI-Generated Models

With Claude Desktop configured, ask Claude to create CAD:

> "Create a mounting bracket with two M5 holes spaced 40mm apart"

Claude will use the MCP tools to:
1. Call `create_cad_document` with the geometry
2. Call `inspect_cad` to verify dimensions
3. Call `export_cad` to save the STL file

### Validation Script

Check model properties programmatically:

```typescript
import { Client } from "@modelcontextprotocol/sdk/client/index.js";

// Create document
const ir = await client.callTool("create_cad_document", {
  parts: [{
    name: "Part",
    primitive: { type: "cube", size: { x: 10, y: 10, z: 10 } }
  }]
});

// Inspect properties
const props = await client.callTool("inspect_cad", { ir });
console.log(`Volume: ${props.volume} mm³`);
console.log(`Triangles: ${props.triangleCount}`);

// Export if valid
if (props.volume > 0) {
  await client.callTool("export_cad", { ir, filename: "part.stl" });
}
```

## Error Handling

### CLI Errors

The CLI exits with code 1 on errors and prints descriptive messages:

```bash
$ vcad export missing.vcad out.stl
Error: No such file or directory (os error 2)

$ vcad export model.vcad out.xyz
Error: Unknown output format: xyz
```

### MCP Errors

Tool errors are returned to the LLM for self-correction:

```json
{
  "content": [{"type": "text", "text": "Error: Invalid primitive type 'box', use 'cube' instead"}],
  "isError": true
}
```

<Callout type="tip">
When using MCP tools, always call `inspect_cad` after `create_cad_document` to verify the geometry is valid before exporting.
</Callout>
